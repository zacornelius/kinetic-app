<div class="index-section">
  <div class="page-width{% if section.settings.narrow_column %} page-width--narrow{% endif %}">
    {%- if section.settings.title != blank -%}
      <div class="section-header">
        <h2 class="section-header__title">
          {{ section.settings.title }}
        </h2>
        {%- if section.settings.text != blank -%}
          <div class="rte section-header__rte">{{ section.settings.text }}</div>
        {%- endif -%}
      </div>
    {% endif %}

    <div class="form-vertical">
      <!-- Custom form instead of Shopify contact form -->
      <form id="custom-contact-form" class="contact-form">
        <div class="grid grid--small">
          <div class="grid__item medium-up--one-half">
            <label for="ContactFormName-{{ section.id }}">{{ 'contact.form.name' | t }}</label>
            <input type="text" id="ContactFormName-{{ section.id }}" class="input-full" name="name" autocapitalize="words" value="{% if customer %}{{ customer.name }}{% endif %}" required>
          </div>
        <div class="grid__item medium-up--one-half">
    <label for="ContactFormInquiry_Type-{{ section.id }}">Inquiry Type</label>
<select id="ContactFormInquiry_type-{{ section.id }}" class="input-full" name="inquiry_type" required>
  <option value="" disabled selected hidden>Select an option</option>
  <option value="Bulk Purchase">Bulk Purchase</option>
  <option value="Product Issue">Product Issue</option>
  <option value="General Question">General Question</option>
</select>
        </div>
        </div>
      <div class="grid grid--small">
          <div class="grid__item medium-up--one-half">
      
          <label for="ContactFormPhone-{{ section.id }}">{{ 'contact.form.phone' | t }}</label>
          <input type="tel" id="ContactFormPhone-{{ section.id }}" class="input-full" name="phone" pattern="[0-9\-]*" value="{% if customer %}{{ customer.phone }}{% endif %}">
          </div>
          <div class="grid__item medium-up--one-half">
            <label for="ContactFormEmail-{{ section.id }}">{{ 'contact.form.email' | t }}</label>
            <input type="email" id="ContactFormEmail-{{ section.id }}" class="input-full" name="email" autocorrect="off" autocapitalize="off" value="{% if customer %}{{ customer.email }}{% endif %}" required>
          </div>
      </div>

      
      <div class="grid grid--small">
          <div class="grid__item medium-up--one-half">
    <label for="ContactFormUsage-{{ section.id }}">Usage</label>
    <select id="ContactFormUsage-{{ section.id }}" class="input-full" name="usage">
    <option value="" disabled selected hidden>Select an option</option>
     <option value="Active Dog Owner">Active Dog Owner</option>
      <option value="Breeder">Breeder</option>
    <option value="Trainer">Trainer</option>
    <option value="Handler">Handler</option>
    <option value="Kennel">Kennel</option>
    <option value="Military">Military</option>
    <option value="Law Enforcement">Law Enforcement</option>
    <option value="Other">Other</option>
    </select>
          </div>
       
        <div class="grid__item medium-up--one-half">
      <label for="ContactFormDogs-{{ section.id }}">Number of Dogs</label>
      <input type="number" id="ContactFormDogs-{{ section.id }}" class="input-full" name="number_of_dogs">
         </div>
        </div>
      
        <label for="ContactFormMessage-{{ section.id }}">{{ 'contact.form.message' | t }}</label>
        <textarea rows="5" id="ContactFormMessage-{{ section.id }}" class="input-full" name="body" required></textarea>

        <label for="contact-form-submit-{{ section.id }}" class="hidden-label">{{ 'contact.form.send' | t }}</label>
 <button type="submit" id="contact-form-submit-{{ section.id }}" class="btn">
          {{ 'contact.form.send' | t }}
        </button>

        {% comment %}
          Remove the following three lines of code to remove the note
          about being protected by Google's reCAPTCHA service.
          By removing it, the small reCAPTCHA widget will appear in the
          bottom right corner of the page.
        {% endcomment %}
        {{ 'shopify.online_store.spam_detection.disclaimer_html' | t }}

      </form>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('custom-contact-form');
  
  if (form) {
    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      // Get form data
      const formData = new FormData(form);
      const data = {
        name: formData.get('name'),
        inquiry_type: formData.get('inquiry_type'),
        phone: formData.get('phone'),
        email: formData.get('email'),
        usage: formData.get('usage'),
        number_of_dogs: formData.get('number_of_dogs'),
        body: formData.get('body')
      };
      
      // Validate required fields
      if (!data.name || !data.email || !data.inquiry_type || !data.body) {
        alert('Please fill in all required fields.');
        return;
      }
      
      // Show loading state
      const submitButton = form.querySelector('button[type="submit"]');
      const originalText = submitButton.textContent;
      submitButton.textContent = 'Submitting...';
      submitButton.disabled = true;
      
      try {
        console.log('Submitting data:', data);
        
        // Submit to your database API
        const response = await fetch('https://team.kineticdogfood.com/api/inquiries/submit', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
        
        console.log('Response status:', response.status);
        console.log('Response headers:', response.headers);
        
        const result = await response.json();
        console.log('Response data:', result);
        
        if (response.ok) {
          // Show success message
          const successMessage = document.createElement('div');
          successMessage.className = 'note note--success';
          successMessage.textContent = 'Thank you for your inquiry! We will get back to you soon.';
          
          // Insert success message before the form
          form.parentNode.insertBefore(successMessage, form);
          
          // Reset form
          form.reset();
          
          // Remove success message after 5 seconds
          setTimeout(() => {
            if (successMessage.parentNode) {
              successMessage.parentNode.removeChild(successMessage);
            }
          }, 5000);
          
        } else {
          console.error('API Error:', result);
          throw new Error(result.error || `Server error: ${response.status}`);
        }
        
      } catch (error) {
        console.error('Error submitting form:', error);
        alert(`There was an error submitting your inquiry: ${error.message}. Please try again.`);
      } finally {
        // Reset button state
        submitButton.textContent = originalText;
        submitButton.disabled = false;
      }
    });
  }
});
</script>

{% schema %}
{
  "name": "t:sections.contact-form.name",
  "class": "index-section",
  "settings": [
    {
      "type": "paragraph",
      "content": "t:sections.contact-form.settings.content"
    },
    {
      "type": "text",
      "id": "title",
      "label": "t:sections.contact-form.settings.title.label",
      "default": "Contact us"
    },
    {
      "type": "richtext",
      "id": "text",
      "label": "t:sections.contact-form.settings.text.label"
    },
    {
      "type": "checkbox",
      "id": "show_phone",
      "label": "t:sections.contact-form.settings.show_phone.label"
    },
    {
      "type": "checkbox",
      "id": "narrow_column",
      "label": "t:sections.contact-form.settings.narrow_column.label",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "t:sections.contact-form.presets.contact_form.name"
    }
  ],
  "disabled_on": {
    "groups": ["footer", "header", "custom.popups"]
  }
}
{% endschema %}
